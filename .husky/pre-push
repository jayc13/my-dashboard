#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ§ª Running pre-push checks..."

for dir in client server cron; do
  cd "$(git rev-parse --show-toplevel)" || exit
  cd "./$dir" || exit
  # Install dependencies to avoid problems with dependencies
  echo "ğŸ”¬ Running tests in $dir..."
  npm run test

  if [ $? -eq 0 ]; then
    echo "âœ… All tests passe in $dir!"
  else
    echo "âŒ Tests failed in $dir! Please fix failing tests before pushing."
    exit 1
  fi

  echo "ğŸ—ï¸  Running build in $dir..."
  npm run build

  # If linting passes, run lint:fix to auto-fix issues
  if [ $? -eq 0 ]; then
    echo "âœ… Build passed in $dir!"
    npm run lint-fix
  else
    echo "âŒ Build failed in $dir! Please fix the issues before pushing."
    exit 1
  fi
done

echo "âœ… Pre-push checks completed successfully!"
