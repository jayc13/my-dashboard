#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Install dependencies to avoid problems with dependencies
echo "ğŸ“¦ Installing dependencies..."
npm install --registry=https://registry.npmjs.org/ > /dev/null 2>&1
npm install --registry=https://registry.npmjs.org/ --workspace=client > /dev/null 2>&1
npm install --registry=https://registry.npmjs.org/ --workspace=cron > /dev/null 2>&1
npm install --registry=https://registry.npmjs.org/ --workspace=scripts > /dev/null 2>&1
npm install --registry=https://registry.npmjs.org/ --workspace=server > /dev/null 2>&1

# Run linting across all workspaces
echo "ğŸ“ Running linting..."
npm run lint

# If linting passes, run lint:fix to auto-fix issues
if [ $? -eq 0 ]; then
  echo "âœ… Linting passed! Running auto-fix..."
  npm run lint:fix
else
  echo "âŒ Linting failed! Please fix the issues before committing."
  exit 1
fi

echo "âœ… Pre-commit checks completed successfully!"
